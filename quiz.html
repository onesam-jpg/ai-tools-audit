<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Readiness Assessment | Is Your Business Ready for AI?</title>
    <meta name="description" content="Take this 2-minute quiz to discover if AI can save you 10+ hours per week. Get your personalized AI roadmap.">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #1a1a1a; background: #f8f9fa; min-height: 100vh; }
        
        /* Progress Bar */
        .progress-container { position: fixed; top: 0; left: 0; right: 0; background: #e9ecef; height: 6px; z-index: 100; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); width: 0%; transition: width 0.3s ease; }
        
        /* Container */
        .quiz-container { max-width: 600px; margin: 0 auto; padding: 80px 20px 40px; }
        
        /* Header */
        .quiz-header { text-align: center; margin-bottom: 40px; }
        .quiz-header h1 { font-size: 1.8rem; margin-bottom: 10px; color: #333; }
        .quiz-header p { color: #666; }
        .step-indicator { font-size: 0.9rem; color: #764ba2; font-weight: 600; margin-top: 10px; }
        
        /* Question Card */
        .question-card { background: white; border-radius: 16px; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .question-card.hidden { display: none; }
        .question-number { font-size: 0.85rem; color: #764ba2; font-weight: 600; margin-bottom: 15px; }
        .question-text { font-size: 1.3rem; font-weight: 600; margin-bottom: 25px; }
        
        /* Options */
        .options { display: flex; flex-direction: column; gap: 12px; }
        .option { padding: 18px 20px; border: 2px solid #e9ecef; border-radius: 10px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 12px; }
        .option:hover { border-color: #764ba2; background: #faf8ff; }
        .option.selected { border-color: #764ba2; background: #f0ebff; }
        .option-letter { width: 32px; height: 32px; border-radius: 50%; background: #e9ecef; display: flex; align-items: center; justify-content: center; font-weight: 600; color: #666; flex-shrink: 0; }
        .option.selected .option-letter { background: #764ba2; color: white; }
        .option-text { flex: 1; }
        
        /* Email Collection */
        .email-section { text-align: center; }
        .email-section h2 { font-size: 1.5rem; margin-bottom: 15px; }
        .email-section p { color: #666; margin-bottom: 25px; }
        .email-input { width: 100%; padding: 15px 20px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 1rem; margin-bottom: 15px; }
        .email-input:focus { outline: none; border-color: #764ba2; }
        .name-input { width: 100%; padding: 15px 20px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 1rem; margin-bottom: 15px; }
        .name-input:focus { outline: none; border-color: #764ba2; }
        .email-error { color: #dc3545; font-size: 0.9rem; margin-bottom: 10px; display: none; }
        
        /* Navigation */
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 30px; }
        .nav-btn { padding: 14px 30px; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.2s; border: none; }
        .nav-btn.back { background: #e9ecef; color: #333; }
        .nav-btn.back:hover { background: #dee2e6; }
        .nav-btn.next { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .nav-btn.next:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(118,75,162,0.4); }
        .nav-btn.next:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        
        /* Results */
        .results-card { text-align: center; }
        .results-card h2 { font-size: 2rem; margin-bottom: 20px; }
        .score-badge { display: inline-block; background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 15px 40px; border-radius: 50px; font-size: 1.5rem; font-weight: bold; margin-bottom: 30px; }
        .level-badge { font-size: 1.2rem; color: #764ba2; margin-bottom: 20px; }
        .result-text { color: #666; margin-bottom: 30px; font-size: 1.1rem; }
        .result-cta { display: inline-block; padding: 18px 40px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 1.1rem; transition: all 0.2s; }
        .result-cta:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(118,75,162,0.4); }
        
        /* Save Progress Modal */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 200; padding: 20px; }
        .modal-overlay.show { display: flex; }
        .modal { background: white; border-radius: 16px; padding: 30px; max-width: 400px; text-align: center; }
        .modal h3 { margin-bottom: 15px; }
        .modal p { color: #666; margin-bottom: 20px; }
        .modal-btns { display: flex; gap: 10px; justify-content: center; }
        .modal-btn { padding: 12px 25px; border-radius: 8px; font-weight: 600; cursor: pointer; border: none; }
        .modal-btn.stay { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .modal-btn.leave { background: #e9ecef; color: #333; }
        
        /* Resume Banner */
        .resume-banner { background: #d4edda; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; display: none; }
        .resume-banner.show { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px; }
        .resume-text { color: #155724; }
        .resume-btn { padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .restart-btn { padding: 8px 16px; background: transparent; color: #155724; border: 1px solid #155724; border-radius: 6px; cursor: pointer; font-weight: 600; }
        
        /* Loading */
        .loading { text-align: center; padding: 40px; }
        .spinner { width: 40px; height: 40px; border: 4px solid #e9ecef; border-top-color: #764ba2; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        @media (max-width: 500px) {
            .quiz-container { padding: 60px 15px 30px; }
            .question-card { padding: 25px; }
            .question-text { font-size: 1.1rem; }
        }
    </style>
</head>
<body>
    <div class="progress-container">
        <div class="progress-bar" id="progress"></div>
    </div>
    
    <div class="quiz-container">
        <!-- Resume Banner -->
        <div class="resume-banner" id="resumeBanner">
            <span class="resume-text">üëã Welcome back! Continue where you left off?</span>
            <div>
                <button class="resume-btn" onclick="resumeQuiz()">Continue</button>
                <button class="restart-btn" onclick="restartQuiz()">Start Over</button>
            </div>
        </div>
        
        <div class="quiz-header">
            <h1>AI Readiness Assessment</h1>
            <p>Discover if AI can save you 10+ hours per week</p>
            <div class="step-indicator" id="stepIndicator">Question 1 of 10</div>
        </div>
        
        <div id="quizContent">
            <!-- Questions will be rendered here -->
        </div>
    </div>
    
    <!-- Exit Modal -->
    <div class="modal-overlay" id="exitModal">
        <div class="modal">
            <h3>Wait! Don't lose your progress üôè</h3>
            <p>You're <span id="progressPercent">30%</span> done. Want to save your answers and finish later?</p>
            <div class="modal-btns">
                <button class="modal-btn stay" onclick="hideExitModal()">Keep Going</button>
                <button class="modal-btn leave" onclick="confirmLeave()">Leave Anyway</button>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'ai_quiz_progress';
        const WEBHOOK_URL = 'https://empireflows.com/webhook/ai-quiz';
        
        const questions = [
            {
                id: 1,
                text: "How well do you know where your time goes each week?",
                options: [
                    { letter: 'A', text: "I have no idea‚Äîdays just disappear", points: 0 },
                    { letter: 'B', text: "Rough sense, but not tracked", points: 1 },
                    { letter: 'C', text: "I track most of my time", points: 2 },
                    { letter: 'D', text: "Every hour is accounted for", points: 3 }
                ]
            },
            {
                id: 2,
                text: "How many hours/week do you spend on repetitive tasks (email, scheduling, data entry)?",
                options: [
                    { letter: 'A', text: "20+ hours", points: 3 },
                    { letter: 'B', text: "10-20 hours", points: 2 },
                    { letter: 'C', text: "5-10 hours", points: 1 },
                    { letter: 'D', text: "Less than 5 hours", points: 0 }
                ]
            },
            {
                id: 3,
                text: "What's your current AI usage?",
                options: [
                    { letter: 'A', text: "Never tried AI tools", points: 0 },
                    { letter: 'B', text: "Tried ChatGPT a few times", points: 1 },
                    { letter: 'C', text: "Use AI weekly for specific tasks", points: 2 },
                    { letter: 'D', text: "AI is integrated into daily workflow", points: 3 }
                ]
            },
            {
                id: 4,
                text: "Do you have documented processes (SOPs) for key tasks?",
                options: [
                    { letter: 'A', text: "What's an SOP?", points: 0 },
                    { letter: 'B', text: "In my head, not written", points: 1 },
                    { letter: 'C', text: "Some documented, most not", points: 2 },
                    { letter: 'D', text: "All key processes documented", points: 3 }
                ]
            },
            {
                id: 5,
                text: "How many software tools do you use to run your business?",
                options: [
                    { letter: 'A', text: "1-3 tools", points: 1 },
                    { letter: 'B', text: "4-7 tools", points: 2 },
                    { letter: 'C', text: "8-12 tools", points: 2 },
                    { letter: 'D', text: "13+ tools (tool overload)", points: 1 }
                ]
            },
            {
                id: 6,
                text: "Do your tools talk to each other (integrate)?",
                options: [
                    { letter: 'A', text: "No, everything is manual", points: 0 },
                    { letter: 'B', text: "A few are connected", points: 1 },
                    { letter: 'C', text: "Most are integrated", points: 2 },
                    { letter: 'D', text: "Fully automated workflows", points: 3 }
                ]
            },
            {
                id: 7,
                text: "What's your biggest bottleneck right now?",
                options: [
                    { letter: 'A', text: "Finding clients/leads", points: 1 },
                    { letter: 'B', text: "Delivering to clients", points: 2 },
                    { letter: 'C', text: "Admin/operations (high AI opportunity)", points: 3 },
                    { letter: 'D', text: "Hiring/team", points: 1 }
                ]
            },
            {
                id: 8,
                text: "How comfortable are you with new technology?",
                options: [
                    { letter: 'A', text: "Technology frustrates me", points: 0 },
                    { letter: 'B', text: "I can learn if shown", points: 1 },
                    { letter: 'C', text: "I figure things out quickly", points: 2 },
                    { letter: 'D', text: "I love new tech", points: 3 }
                ]
            },
            {
                id: 9,
                text: "What's your time worth per hour?",
                options: [
                    { letter: 'A', text: "Under $50/hour", points: 1 },
                    { letter: 'B', text: "$50-$100/hour", points: 2 },
                    { letter: 'C', text: "$100-$250/hour", points: 3 },
                    { letter: 'D', text: "$250+/hour", points: 4 }
                ]
            },
            {
                id: 10,
                text: "What would you do with 10 extra hours/week?",
                options: [
                    { letter: 'A', text: "Finally take time off", points: 1 },
                    { letter: 'B', text: "Work on strategy, not tasks", points: 2 },
                    { letter: 'C', text: "Grow revenue significantly", points: 3 },
                    { letter: 'D', text: "All of the above", points: 3 }
                ]
            }
        ];
        
        const levels = [
            { min: 0, max: 10, name: "AI Beginner üå±", text: "You're leaving significant time and money on the table. Start with the basics‚Äîmap your workflows, identify your time vampires, then add AI strategically.", cta: "Book Your AI Tools Audit", ctaUrl: "https://calendly.com/onesam69/30min" },
            { min: 11, max: 18, name: "AI Aware üîÑ", text: "You know AI could help, but haven't cracked the code yet. You have the foundation‚Äînow you need the right tools matched to your specific bottlenecks.", cta: "Book Your AI Tools Audit", ctaUrl: "https://calendly.com/onesam69/30min" },
            { min: 19, max: 25, name: "AI Ready üöÄ", text: "You're primed for transformation. Your systems are in place‚Äîfull AI integration could save you 10-20 hours/week and unlock serious growth.", cta: "Apply for AI Accelerator", ctaUrl: "https://calendly.com/onesam69/30min" },
            { min: 26, max: 32, name: "AI Advanced ‚ö°", text: "You're ahead of 95% of businesses. Let's optimize what's working with advanced automations, AI agents, and scaling your systems.", cta: "Book Strategy Call", ctaUrl: "https://calendly.com/onesam69/30min" }
        ];
        
        let state = {
            currentQuestion: 0,
            answers: {},
            email: '',
            name: '',
            emailCaptured: false,
            startedAt: new Date().toISOString(),
            lastActivity: new Date().toISOString()
        };
        
        let isLeaving = false;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkSavedProgress();
            render();
            setupExitDetection();
        });
        
        function checkSavedProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const parsed = JSON.parse(saved);
                // Only show resume if they answered at least 1 question
                if (Object.keys(parsed.answers).length > 0) {
                    state = parsed;
                    document.getElementById('resumeBanner').classList.add('show');
                }
            }
        }
        
        function resumeQuiz() {
            document.getElementById('resumeBanner').classList.remove('show');
            render();
        }
        
        function restartQuiz() {
            localStorage.removeItem(STORAGE_KEY);
            state = {
                currentQuestion: 0,
                answers: {},
                email: '',
                name: '',
                emailCaptured: false,
                startedAt: new Date().toISOString(),
                lastActivity: new Date().toISOString()
            };
            document.getElementById('resumeBanner').classList.remove('show');
            render();
        }
        
        function saveProgress() {
            state.lastActivity = new Date().toISOString();
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        }
        
        function render() {
            const content = document.getElementById('quizContent');
            const progress = document.getElementById('progress');
            const stepIndicator = document.getElementById('stepIndicator');
            
            // Email capture after Q3
            if (state.currentQuestion === 3 && !state.emailCaptured) {
                progress.style.width = '30%';
                stepIndicator.textContent = 'Quick checkpoint';
                content.innerHTML = renderEmailCapture();
                return;
            }
            
            // Results
            if (state.currentQuestion >= questions.length) {
                progress.style.width = '100%';
                stepIndicator.textContent = 'Results';
                content.innerHTML = renderResults();
                sendResults();
                localStorage.removeItem(STORAGE_KEY);
                return;
            }
            
            // Question
            const q = questions[state.currentQuestion];
            const adjustedQ = state.emailCaptured && state.currentQuestion >= 3 ? state.currentQuestion : state.currentQuestion;
            const totalProgress = ((adjustedQ + (state.emailCaptured ? 1 : 0)) / (questions.length + 1)) * 100;
            progress.style.width = totalProgress + '%';
            stepIndicator.textContent = `Question ${state.currentQuestion + 1} of ${questions.length}`;
            
            content.innerHTML = renderQuestion(q);
        }
        
        function renderQuestion(q) {
            const selectedAnswer = state.answers[q.id];
            return `
                <div class="question-card">
                    <div class="question-number">QUESTION ${q.id}</div>
                    <div class="question-text">${q.text}</div>
                    <div class="options">
                        ${q.options.map(opt => `
                            <div class="option ${selectedAnswer === opt.letter ? 'selected' : ''}" 
                                 onclick="selectOption(${q.id}, '${opt.letter}', ${opt.points})">
                                <div class="option-letter">${opt.letter}</div>
                                <div class="option-text">${opt.text}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="nav-buttons">
                        ${state.currentQuestion > 0 ? '<button class="nav-btn back" onclick="goBack()">‚Üê Back</button>' : '<div></div>'}
                        <button class="nav-btn next" onclick="goNext()" ${!selectedAnswer ? 'disabled' : ''}>
                            ${state.currentQuestion === questions.length - 1 ? 'See Results ‚Üí' : 'Next ‚Üí'}
                        </button>
                    </div>
                </div>
            `;
        }
        
        function renderEmailCapture() {
            return `
                <div class="question-card email-section">
                    <h2>You're doing great! üéâ</h2>
                    <p>Before we continue, where should we send your personalized results?</p>
                    <input type="text" class="name-input" id="nameInput" placeholder="Your first name" value="${state.name}">
                    <input type="email" class="email-input" id="emailInput" placeholder="Your email address" value="${state.email}">
                    <div class="email-error" id="emailError">Please enter a valid email address</div>
                    <p style="font-size: 0.85rem; color: #999; margin-top: 10px;">We'll email your results + a personalized AI roadmap. No spam, ever.</p>
                    <div class="nav-buttons">
                        <button class="nav-btn back" onclick="goBackFromEmail()">‚Üê Back</button>
                        <button class="nav-btn next" onclick="submitEmail()">Continue ‚Üí</button>
                    </div>
                </div>
            `;
        }
        
        function renderResults() {
            const score = calculateScore();
            const level = levels.find(l => score >= l.min && score <= l.max);
            
            return `
                <div class="question-card results-card">
                    <h2>Your AI Readiness Score</h2>
                    <div class="score-badge">${score}/32</div>
                    <div class="level-badge">${level.name}</div>
                    <p class="result-text">${level.text}</p>
                    <a href="${level.ctaUrl}" class="result-cta">${level.cta}</a>
                    <p style="margin-top: 20px; color: #999; font-size: 0.9rem;">
                        ${state.email ? `Results sent to ${state.email}` : ''}
                    </p>
                </div>
            `;
        }
        
        function selectOption(questionId, letter, points) {
            state.answers[questionId] = letter;
            state.answerPoints = state.answerPoints || {};
            state.answerPoints[questionId] = points;
            saveProgress();
            render();
        }
        
        function goBack() {
            if (state.currentQuestion > 0) {
                state.currentQuestion--;
                saveProgress();
                render();
            }
        }
        
        function goBackFromEmail() {
            state.currentQuestion = 2;
            render();
        }
        
        function goNext() {
            if (state.currentQuestion < questions.length) {
                state.currentQuestion++;
                saveProgress();
                render();
                
                // Send partial progress if email captured
                if (state.emailCaptured) {
                    sendPartialProgress();
                }
            }
        }
        
        function submitEmail() {
            const emailInput = document.getElementById('emailInput');
            const nameInput = document.getElementById('nameInput');
            const emailError = document.getElementById('emailError');
            const email = emailInput.value.trim();
            const name = nameInput.value.trim();
            
            if (!email || !email.includes('@') || !email.includes('.')) {
                emailError.style.display = 'block';
                return;
            }
            
            state.email = email;
            state.name = name;
            state.emailCaptured = true;
            saveProgress();
            sendPartialProgress();
            render();
        }
        
        function calculateScore() {
            let total = 0;
            for (const [qId, points] of Object.entries(state.answerPoints || {})) {
                total += points;
            }
            return total;
        }
        
        function setupExitDetection() {
            // Detect when user tries to leave
            window.addEventListener('beforeunload', (e) => {
                if (!isLeaving && state.currentQuestion > 0 && state.currentQuestion < questions.length) {
                    // Save progress
                    saveProgress();
                    
                    // If email captured, send abandonment webhook
                    if (state.emailCaptured) {
                        sendAbandonmentWebhook();
                    }
                    
                    // Show browser's native dialog
                    e.preventDefault();
                    e.returnValue = '';
                }
            });
            
            // Custom exit modal on back button or link click
            document.addEventListener('click', (e) => {
                if (e.target.tagName === 'A' && e.target.href && !e.target.href.includes('calendly')) {
                    if (state.currentQuestion > 0 && state.currentQuestion < questions.length) {
                        e.preventDefault();
                        showExitModal();
                    }
                }
            });
        }
        
        function showExitModal() {
            const percent = Math.round((state.currentQuestion / questions.length) * 100);
            document.getElementById('progressPercent').textContent = percent + '%';
            document.getElementById('exitModal').classList.add('show');
        }
        
        function hideExitModal() {
            document.getElementById('exitModal').classList.remove('show');
        }
        
        function confirmLeave() {
            isLeaving = true;
            if (state.emailCaptured) {
                sendAbandonmentWebhook();
            }
            window.history.back();
        }
        
        async function sendPartialProgress() {
            try {
                await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        event: 'progress',
                        email: state.email,
                        name: state.name,
                        questionsAnswered: Object.keys(state.answers).length,
                        totalQuestions: questions.length,
                        currentScore: calculateScore(),
                        answers: state.answers,
                        startedAt: state.startedAt,
                        timestamp: new Date().toISOString()
                    })
                });
            } catch (e) {
                console.log('Webhook error:', e);
            }
        }
        
        async function sendAbandonmentWebhook() {
            try {
                const recoveryUrl = `https://empireflows.com/quiz.html?resume=1&email=${encodeURIComponent(state.email)}`;
                await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        event: 'abandoned',
                        email: state.email,
                        name: state.name,
                        questionsAnswered: Object.keys(state.answers).length,
                        totalQuestions: questions.length,
                        currentScore: calculateScore(),
                        answers: state.answers,
                        recoveryUrl: recoveryUrl,
                        startedAt: state.startedAt,
                        abandonedAt: new Date().toISOString()
                    })
                });
            } catch (e) {
                console.log('Webhook error:', e);
            }
        }
        
        async function sendResults() {
            try {
                const score = calculateScore();
                const level = levels.find(l => score >= l.min && score <= l.max);
                await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        event: 'completed',
                        email: state.email,
                        name: state.name,
                        score: score,
                        maxScore: 32,
                        level: level.name,
                        levelRecommendation: level.text,
                        answers: state.answers,
                        answerPoints: state.answerPoints,
                        startedAt: state.startedAt,
                        completedAt: new Date().toISOString()
                    })
                });
            } catch (e) {
                console.log('Webhook error:', e);
            }
        }
        
        // Handle resume from email link
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('resume') === '1') {
            const emailParam = urlParams.get('email');
            if (emailParam) {
                // Try to find saved state matching this email
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const parsed = JSON.parse(saved);
                    if (parsed.email === emailParam) {
                        state = parsed;
                        render();
                    }
                }
            }
        }
    </script>
</body>
</html>
